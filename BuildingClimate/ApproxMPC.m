function [Y,Xf,Af] = ApproxMPC(X,~,~)
%APPROXMPC neural network simulation function.
%
% Auto-generated by MATLAB, 17-Jul-2020 18:11:08.
% 
% [Y] = ApproxMPC(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [10.8574273438591;10.9371838971826;10.9427414066011;10.8220539913288;0.0700978943647134;0.000778601831887471;-4.98480165183461;18.0055961963254];
x1_step1.gain = [0.0608682984291649;0.0607860122715845;0.0613815324020895;0.0605485099100378;0.0456869956516188;10.0399987504643;0.100119324205015;0.286849116882376];
x1_step1.ymin = -1;

% Layer 1
b1 = [1.1628235717401653737;0.22372619619252792633;-0.077075356578359746629;0.83166258446207474986;0.10107209586213856956;-0.021283680004355272353;0.15877508698228559592;-0.095250025414042177596;1.4063414203592741192;0.49351495562940028705];
IW1_1 = [-0.015876174793567902205 -0.034074896849967221957 -0.24161813412402588508 -0.24372112631954842565 1.2776762576935503102 0.028492814565201345783 0.015650289724876177699 0.11687414236150180102;0.091401426551019931965 -0.052534904267186197102 0.22974802854593209811 0.30044263335897197775 0.014991946478673474907 -0.062920850570249778344 0.28729088798787361103 -0.13093873050050539031;-0.097635489561455041096 0.1168482936092073432 -0.44160572398460090637 -0.049871183222346841812 -0.25477329745583149334 -0.10245905555287386501 0.037204428407671047419 0.043202846854153403866;0.33296353072341566826 -0.26482925084133024374 -0.22123069684356039266 -0.016834244570737781632 -0.3817340468435292955 -0.53452912726557788581 -0.59771494939283309478 0.26467195650667524331;0.098370278418355522332 0.010926047543328931688 -0.15780011911013275272 -0.1707598174322540463 0.48646864238828035898 0.20650950728231420861 -0.11328318807031331761 0.13422721042506108313;0.0060010330228574279912 -0.0099552805555076194499 -0.017892574320632938234 -0.19580736746296575901 -0.071696449350945282153 0.0052592432169470699349 -0.057573607996312420321 0.10048453521722884585;-0.17505080818616985949 0.0084849496272479795617 -0.29135389587583010451 0.016454331979275777648 0.19518283942218761506 -0.12013512522224834012 0.14716598672952097004 0.034901428506923626305;-0.23737274294420826481 0.57446883893786870878 -0.22234179011128715753 -0.35985541440987162121 -0.50127517068169480385 -0.16723966623047104019 0.03894844824363167396 -0.18599691138061436035;0.0296336911093775697 -0.044099931263120929759 0.044579243790003691972 0.21310944639294829295 -2.4359057517760560607 -0.038759773508492897931 0.20007927174006057136 -0.1252479364198354761;-0.46734977156404516885 0.0042088054913227666842 -0.24474297025383542903 0.28359878725586062931 -0.47044704597760095277 0.12191400400118942993 0.54223455754782556859 -0.22235506353948578107];

% Layer 2
b2 = [1.0313980423404571773;-0.5753446656576620688;2.4732599088314897173;-3.1461456997473198349;-3.7016446267474742982;-2.6234398680289459094;1.0652918435140963371;0.11836419732535224947;-3.0528570960422247715;-3.7523581684661766467];
LW2_1 = [-0.87281160518296629913 0.48914473953748160984 -0.63047005184527360466 0.6661872131618695736 2.922818238953434733 0.17066441393457776332 -0.93644565062392326471 1.1844480543763309388 2.4289894158131888346 1.7340208909242282864;1.5448106273241810626 0.82348674714433411914 -0.17090739786464739791 -1.4805952620461992897 0.14471606947657036923 0.2963313809948551758 0.27770143569143396212 -2.1093166559821567851 0.3434632623731992962 1.3045279270976302133;0.11065451629382277998 1.3454827402699256478 2.285765075355301601 -0.2341795558331868643 -1.5512324662127756625 3.4428963361653619479 -1.8449829098393248916 -1.7850527728563125862 -0.75786913493607943604 -0.52590381680995534897;3.0948943242193989178 0.19345615108454397579 1.4291728966594243744 0.50955015490240684883 0.069294584963868408045 -1.0471718977039603526 0.074064328645200738777 -0.46841502759016184765 0.8501151849063850463 -0.019742147100532195236;1.8331763404135588136 -0.33408519124843788495 -1.0137073804442020553 0.9564417740966508763 2.1494199324510034899 -2.1305475726968952088 0.70430014217626635276 0.18687917418754679266 1.8529560200677790416 0.36001933819053616448;1.1061551373456697256 0.84515438795409147943 -1.0502968156271288436 0.45405871805626535354 0.86408218620441246127 -0.55940812215831392518 -2.0780435681302908968 0.30332018434726126799 0.50193763530313995069 2.7645789893080592314;-0.63691436216528796166 1.0567799228291561153 1.278589507256634672 -0.003547585081197402769 1.1714780537189894982 0.50477478422018118298 -0.77596710637950261358 -1.022929148226598306 -0.49077602026186895046 0.9127363387336135947;-0.53614683820825492777 0.59470214691726797085 -0.32085354792469800156 0.40791753624705107129 1.3804734142663299679 0.39769080297966552529 -0.47129212955800708906 0.87921990615837741778 -0.25967634139103756841 0.68760617478573549111;2.9133263134328455379 -1.8354403014285127771 0.63698661556156621621 -0.39802009585774567046 1.0266970575711706903 -2.37340031760989989 1.138852874621949729 -0.94558491168248648417 1.3203733429244683961 -1.0913648078563078503;1.9084998677535269795 2.3628774497902202967 -1.7067986569726174562 1.1000308316632594341 0.18060352897434836517 -2.3208219826385527718 2.27742957618637476 -0.053073194436375793759 1.3695066164932181429 -1.4400856013959779656];

% Layer 3
b3 = [-0.9457368411219644333;8.5363781350694285521;6.355208310797721083;3.5869606268157596674;-0.025598569842271393093;-9.9427382907431844927;-0.06375503864879179805;-4.4748637668117670074;4.0418087014786578948;-5.4889153503835901304];
LW3_2 = [7.0910470588704237471 3.8922785845186780307 -2.865723029824678747 0.19806266054814503086 -7.9175459004584212153 -10.667564220949756759 4.5631894537864754469 -0.24551641324376219377 2.5307663694736723947 -5.9709567539733194863;-2.2670898489865942693 0.68114854478090414158 -2.8718624468010593986 -2.1568473735697275551 3.127347148394777232 1.798668189482971469 5.5152748344215156706 9.6072314600907056104 -1.3183140374166784081 -1.936935177086750226;4.5585377144124938908 -2.1565874957983650617 -1.7884281181883088241 -2.9844283044325239374 -0.74227835784809836905 -6.5885472462822063378 0.0095313661879081797851 -4.1544949722570665429 0.87968548634981436063 2.4946515665382875682;-0.93717079722254092999 -0.23099828755958159987 -0.60791437884786259094 -0.62363623840409920795 1.0297375104581394378 0.60075385636672773426 -0.12455810684288795565 3.525123775446313612 -0.13636775576535939414 -0.79536122563859523726;3.661313436190672288 0.70007066751920465908 1.2784924415747542792 -1.4624915559025046807 -0.13847779743848684375 0.913800257029954488 -1.7250180090413773648 -4.537868190554775083 -1.0208140243310197537 1.8349023097548629035;2.1253272872962400974 1.0190498149331013167 0.82359812652193975513 0.12292380613565308256 -2.9860732386200790067 -2.2766412558326156734 -3.2020279676880103459 -5.5621091548691330431 4.6112312102950356874 2.7453750670322283334;3.8043232687266814729 1.2531144517244532377 2.0855601660225411287 -0.13006087652773543062 -0.075404792003318663052 0.3291202409832127973 -2.9143165876473973164 -7.015137765288214311 0.76731545571634485192 -1.7814563167968031632;1.8885686014611862138 1.428508012002669636 1.1050642077845094224 0.10665425807299828975 7.1828879546809076828 24.128337924684981175 -9.0965763778511359305 3.494121286915955249 1.9317000600936160559 1.8198666376186227733;-0.082160628016562181619 -6.2083006884442051287 -1.4575125612798327523 0.49963703912159496134 -0.50508658700246567008 3.5459244635547300106 -0.25814016922399996012 -5.1429744952400797686 0.26417030146340403363 -5.3351663740634691635;1.812530132832530283 0.71292100624383947238 1.3122416126109257561 1.1598177371649778244 -3.1195802079630694514 -1.9151380798181445453 -1.0404927376558026353 -1.3533351828918354087 -0.06727585390101339935 1.4340464919906676933];

% Layer 4
b4 = 0.50691512685308137698;
LW4_3 = [0.0012814930191372175036 -0.0086108851641331432547 -0.0011496960841428003307 -0.021938316355983727979 -0.035150136072433946222 0.0090859419071854657934 -0.013302458942288826471 0.0065492457277476958527 -0.003269647024730961294 0.021630672933002421943];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0508342341351508;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = poslin_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = poslin_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = poslin_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = repmat(b4,1,Q) + LW4_3*a3;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a4,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(4,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Linear Positive Transfer Function
function a = poslin_apply(n,~)
  a = max(0,n);
  a(isnan(n)) = nan;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
