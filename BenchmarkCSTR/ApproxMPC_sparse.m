function [Y,Xf,Af] = ApproxMPC_sparse(X,~,~)
%APPROXMPC_SPARSE neural network simulation function.
%
% Auto-generated by MATLAB, 16-Mar-2021 23:19:08.
% 
% [Y] = ApproxMPC_sparse(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 2xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [0.0632;0.540788888888889];
x1_step1.gain = [5;6.42857142857143];
x1_step1.ymin = -1;

% Layer 1
b1 = [-4.3683445308984518718;-3.1741410678281640756;2.4235304511953641438;-1.3547788959088540306;0.66937510748916329018;-1.4071924387323280214;1.5121049537372917015;2.5909296544123949779;3.3846679775803774071;4.6876766906849374195];
IW1_1 = [2.9004929426611592014 3.3938441642428118783;4.4347702853932657874 -1.2983559429641080563;-4.3234488013957292907 -1.1947396069835274357;1.6097270515990476092 4.2607378878599444505;-4.1974620473757919825 1.3295255229515392514;-0.18346414716216138951 -3.7841533692977096237;3.6605908690313673226 2.3180240650532049074;2.798132629459517684 -3.1232038700572046785;3.7619714324002795358 -2.3605036412617153019;4.2016039940737908154 0.11497974714525356632];

% Layer 2
b2 = [-1.7802348773631506695;-1.441035639853760264;-1.0788254585145498066;0.6759365529868001099;0.12953151643979182728;0.14230789844953989354;-0.73277955522623494655;0.89389377952415793871;1.376419472755298079;-1.7793368459979252982];
LW2_1 = [1.0604599177687061839 -0.31533150259609304955 -0.54935858456277975037 0.71241738145071675792 0.05440031643141367973 0.024949898464000825477 -0.98671245455295730764 0.2773915770118054458 -0.010620449853873144622 0.17814402843464316462;0.72230951260174791617 -0.89348287942322512922 -0.43233725542045442491 0.57927804022546913743 -0.20554324032554449619 -0.099822996204291844502 -0.14644266548980583442 0.16193975546385411257 0.54941111958791721825 -0.96040797227805396741;0.48188691683474910166 -0.97377091939314985858 -0.033112977249020736359 0.79688484901220391077 -0.69193814207571158192 -0.5271771401029589077 0.11094255770581028242 -0.4833763381661074221 0.44748760697853096069 0.36310687546713116269;-0.93336008023693872726 -0.58837145524309064637 -0.45437983767964340576 0.25170389128481229779 0.51071536363884539877 -0.11792369619050019347 -0.19804559611573097078 -0.0035133589042356735965 0.85952387627436865891 0.71765893744617215155;-0.036875568365382208058 0.13013353232152319316 -0.53604695642535649114 -1.1163449070477626801 0.94598459055201911116 -0.49606665060252064237 0.66352280273646158104 -0.40243341139612953672 -0.08950616200833763636 0.14713991432395551184;0.77974312365697284744 0.77596615462964468879 0.48911865098749102154 0.41192740996100440931 0.47429852760505147868 -0.89746243775480361027 -0.18455762067039321872 0.046678445876952870397 0.65949787440369544989 -0.41064871113834361394;-0.65841772647067842161 -0.38112810112605693957 0.74059943267676386913 0.53597411835443597994 -0.093920468013109895122 0.80042845205116386342 0.41991691412693504803 -0.45482662704823206834 0.13476490370422222753 1.0189757313133527283;0.83739800177567857986 -0.25693523071926760437 0.08767286667961686486 -0.80992010492240440467 -0.67696468316861013736 -1.1992265486617883496 -0.32214517948579779461 -0.53052341034059580238 0.31357490588996062009 -0.080469353516925398728;0.80979728418892904518 -0.30133426157834170001 -0.093754376088192550864 0.11443081879086304531 -0.37748131047059241272 0.4629248939048062339 -0.87212816332127096608 0.45558652543039124261 0.93008010671340790587 0.28880726012680252301;-1.0589794385783437569 0.54519351310679564637 -0.20125182787674569806 -0.1319620869563626897 -0.87554387079387330228 -0.57923465029815479621 0.091325425071602267524 0.41597007128740332016 0.44832092611864027276 0.14581120710905354221];

% Layer 3
b3 = [1.7696951931059790031;1.3847527190955513099;0.9075845012147897295;0.46159160745307320495;0.12825528264578822668;0.19216305716819981342;0.56932032596945436609;-0.99717126222433249971;1.2833721442345109587;-1.7243489848472171033];
LW3_2 = [-0.41072191357188236882 -0.10439487016437992706 0.18983177362629827245 0.72929767956914681726 -0.10395556318438149701 -0.89582463705468662329 0.87005655009107563114 -0.67920650330031440145 0.45958510200505248156 0.34039060195769293982;-0.70777580824731645137 -0.55159134379351160149 -0.70268128792569495289 0.53693252821282455578 0.59523416039668108901 0.46297363312694728155 0.2940635224807859327 -0.68334738448259146892 -0.0092015018211814032095 0.63173404912680353185;-0.72246700594357438074 1.0421068871550154267 -0.27474693316083531602 0.10867028748436456664 0.85088209764171951477 -0.50149871278662283558 -0.25063412197468687426 0.61852035918992054331 0.1671478250663848697 -0.11770184578479289672;-0.20040005213516146054 -0.012944601147098812322 0.40939770255197488469 0.7069132142700672583 -0.22474460469777998717 -0.89955733106802204802 0.17876374982900616883 -1.0513236705400981208 -0.98480699162241858158 -0.43800203257434622284;-0.29130868505314538863 0.65491186289393499287 0.95634703961031142239 0.27513530846039990774 0.53973741435160094149 0.55804977262486810119 0.54346852793635258561 0.67564337661748175012 -0.78541651967218628627 -0.2411695935258089396;0.05387718845830911929 0.6610588762219167247 -0.70337747506991554758 0.86575626403483585403 -0.2205824882902009676 -0.2308953757674024887 0.48988146078882532919 -0.36677235652339990057 0.89045352916373066154 -0.34089922397581662317;0.5515169315581572862 0.85736827294122730514 0.66720667238287822975 -0.47696872921683691748 -0.045516741871446560197 -0.35338544044020042678 0.10001351756217183309 0.4747980509693511264 -0.96887174496650163569 0.32583409520138773008;-0.15698250132939584045 -0.46676620395343348946 0.61503696017567699439 -0.75335773793123439468 0.20731237112703082559 0.44757099741124289904 -0.75223160931119603667 0.85066415499481862206 0.17037628618397845925 -0.90682074577945626093;0.31200949317658316362 0.36157790234729658696 -0.92640614665992582211 -0.86722453670510080137 0.34210360754887958468 -0.037278938173951836621 -0.77151322904447439122 0.7407091901128927125 0.40521938141497365615 0.096812015967187581289;-0.75408681910700670059 -0.80482286123313984127 -0.35245199761872358923 0.43477418340556961418 0.56815315412827227526 0.42042530136718220257 0.68313512881039062385 0.005834873160182421116 0.20158788664109361655 -0.93363354504827689162];

% Layer 4
b4 = [-1.7017681878432486808;1.358174947920822051;0.9057823184607598499;-0.76040208092340233481;-0.20754559626435778452;-0.13017596588188129481;0.67857172376024776916;0.98407367399428424815;1.3656067434018757112;-1.7017088798031196895];
LW4_3 = [0.74990574384485697568 0.81154688412171449574 0.86413807652583995988 -0.59340474562496237088 -0.12256015257439968613 0.50480023273915941573 -0.55390711283374705065 -0.084912786390743316689 0.32990592763175974333 -0.53009368992019600952;-0.55053821761726229322 -0.50879254826881159524 -0.43276545975110541908 -0.81257230399928437325 -0.87280124367282396758 -0.014177679233260161509 -0.49714729988775668845 -0.79326550829416619948 -0.51444968276664193585 -0.33476323373424804464;-0.18120324541685933761 0.66052254556228029436 -0.12101563855495009459 -0.93034468725891594776 1.1748584417300313998 -0.67749759305095613726 0.81353134576683672208 0.24849939795337927517 -0.60329255882991661419 -0.37461797525021978128;0.44175295781230744518 -0.73888859111564353377 0.45897297648718266005 0.66259656666943334002 -0.63958298772081390027 -0.55810369558298322801 0.68400658338687336801 0.70119469365557152152 0.57624471652024222834 0.032321129160203396213;0.66509616921676206758 -0.66092992766828517759 0.53684305522660313859 0.23884978529108280565 0.28974022414399075442 0.010744453715827880641 -0.27459368943451978318 -0.53363881862070450257 0.86686653121643597597 0.82991563426987235985;-0.54261272638424762338 -0.22452193573332454579 0.29765294371216205471 -0.87207857428567303604 1.0198234061120043936 0.15179557002426799506 -0.31339767535787710351 -0.23533507238645762216 0.91762408766424319317 0.52790552368916543458;0.091086533418746395974 0.34380208764244402087 0.69984740723139959861 0.67177798278192946135 0.68873400214113145168 0.16097213005983218581 -0.27103822361123258711 -0.82510550475110322477 -0.87251529572930897061 -0.032133344503370936396;0.29306713018207558585 -0.44179002829965124954 0.87661070177116517943 0.70412013816763630025 -0.4205796290906659296 0.54002651580647642593 0.53074234816042653584 0.28328461919900937982 -0.88644009879650687012 0.32508576867946242794;0.78825655246463022241 0.72854032145482083838 -0.67488590874082776683 0.66382344354506406248 -0.37032128370990236021 -0.12242049970611135201 -0.44246388171391209942 0.11922466958601871112 0.83399236997524528459 -0.034040841251838066528;-0.73535474673974010607 0.53093400225745068788 0.5326506657527902977 -0.42513839631466815439 0.088745358545323033139 -0.50374008203730813449 -0.29921378636776257975 0.63633301047139445572 0.9793848523914834292 0.62816307761374023944];

% Layer 5
b5 = [-1.8335642961576703591;-1.4396756913043056159;1.0142009124228077432;-0.60057940931471343049;0.056293559040575556762;-0.0031094911790464172668;0.56189568123700273095;-0.94290966685447619167;1.3680598980879625781;1.7640016437553256434];
LW5_4 = [0.22192946048814859994 0.69831977514530219064 -0.89840111302140734928 0.62516944400243368296 0.43071752127150386702 -0.12068041292212262905 0.72806874523475351157 0.83663363910012822355 0.071860967648366400051 0.7698153971508703286;0.93200836631313421776 0.31964436341740148917 0.67139025558859377618 0.94267417668870068237 -0.320149998078811171 -0.27324355291830559889 0.059482728009781285494 0.415580017840028626 -0.39138264514255710624 0.51650069348235516653;-0.19966712321226701143 0.80002398304756960901 0.55652829716412344219 -0.39783156285920490136 -0.39827745148772730754 0.78647704058046952191 -0.53312973668938468119 -0.41022238081754341943 0.85150627676312962144 0.13075828811601961088;0.051997627174215299561 -0.85929994249723740118 -0.060513591378073175453 -0.10984040464765919276 0.20917481029940057646 0.68216189240872426858 -0.62975173639221360133 -1.0155116607825247499 0.44667980389524708507 0.43643894242543362916;-0.47823979211459705096 -0.36479945759762988367 0.85736355976405642654 0.23289161221012849579 -0.75376214872352831353 -0.73774561241177039062 -0.32849822363908903755 0.64915008016597786078 -0.6327023882009568112 0.068443968577508701445;-0.5724527635582395968 -0.45892557985021570355 0.53874503910974291809 -0.78369710307525730641 0.37439909217624228743 -0.751289159599351275 0.2472798719485505281 0.51545741933485211828 0.92660971307299733191 -0.25675183784851934865;0.47052992301848572954 0.0072826987681287938536 0.6992722642292539259 0.30765989340650407025 0.23055595480348231585 -0.66687657209539252801 0.71234086814411567978 0.57963221351560501038 0.48724379545872920083 0.82448658505373539906;-0.15390678125726103831 0.23262598844013804289 -1.0324901782008113482 0.992808028451890201 0.42298795983851172897 -0.5135124871088114773 -0.48979724215113079611 -0.56044276587564079151 0.1098228466912580803 -0.059171730563413751924;0.26341763140332241644 -0.4888227528540589617 -0.6831119908505786098 -0.3601079783769565168 0.71496084471282805861 -0.67865979411925014819 -0.64628380388742379115 0.5070611036264615068 0.45539671103432854959 -0.58447321403735308376;0.26777006912525919136 -1.0587002308618627122 0.66349427579090547447 -0.23512361299632894562 -0.1019296885179452189 0.17523906356400112405 0.75849905431167419234 0.24527012383606386359 0.81064457442928372632 0.30573028687458481123];

% Layer 6
b6 = -0.16131590481999774633;
LW6_5 = [-1.0906176231326645265 -1.1103227318152988357 0.32374746857590402938 0.18151795733911238462 0.033921231658955414145 -0.28846775165524091156 0.18611481004666380334 -0.60729417825235831874 -0.1391545665123222475 -0.34996605144505177343];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = tansig_apply(repmat(b4,1,Q) + LW4_3*a3);
    
    % Layer 5
    a5 = tansig_apply(repmat(b5,1,Q) + LW5_4*a4);
    
    % Layer 6
    a6 = repmat(b6,1,Q) + LW6_5*a5;
    
    % Output 1
    Y{1,ts} = a6;
end

% Final Delay States
Xf = cell(1,0);
Af = cell(6,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end
