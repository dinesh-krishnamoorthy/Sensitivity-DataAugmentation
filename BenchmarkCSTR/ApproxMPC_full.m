function [Y,Xf,Af] = ApproxMPC_full(X,~,~)
%APPROXMPC_FULL neural network simulation function.
%
% Auto-generated by MATLAB, 16-Mar-2021 23:23:53.
% 
% [Y] = ApproxMPC_full(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 2xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [0.0632;0.528630994152047];
x1_step1.gain = [5;6.18679787984587];
x1_step1.ymin = -1;

% Layer 1
b1 = [-4.4355120986096201463;6.1411648135848269092;2.7865280767148399299;-1.7611485440154910354;0.42742005371472330255;-0.23701026053172744024;3.3846609703535057712;1.6509732085460264717;4.2939151608754633216;-3.501310877705172242];
IW1_1 = [3.5455935308197279454 1.0774401804444209141;-6.3631390531762432872 2.9157931987063268053;-1.8979126593402888545 -6.1091204469918407582;1.1642644064693774553 -4.3506373715476760466;2.0975438497141376537 -3.0675162602729160177;0.54188879679156387592 1.285829010999842259;0.87518924876694970116 5.8432717027705178836;3.1640940992232988727 -4.3681944926211135893;2.4529146612680232664 3.6276933033878706603;-1.052714028560576276 3.293825096874971603];

% Layer 2
b2 = [-2.4398214374021534034;1.4376165717271440769;1.1243009581658083285;1.197611051441157981;-0.27212006539897104496;-0.094509107806684838904;-0.28044545165792000851;-0.91889884432512713985;-1.631023463395187445;1.7211977422156454764];
LW2_1 = [-0.078328627055329794193 -0.00041523444714047222023 0.91087218673206049591 -1.4242623223068087146 1.1880013991786173566 -1.1770212101549504258 1.5244952965526876731 0.79820795231788344015 -0.92058188775988369912 0.15433081627226691301;-0.23929445561800896658 0.67735309434000867679 0.40249350548542434103 0.29250991890182098665 -0.44999349232387447772 -0.15258135680718767913 0.66324152753637777291 -0.49220514470572873655 -0.54982831626867822994 -0.66386842438860638183;-0.7288123158868365925 -0.31531641603069610058 -0.12884009560456041732 -0.39412617831185675632 0.79308920563736662324 0.44461137079898660485 -1.1776950870337923316 0.61341536464349932789 0.4417577411810993393 -0.86796607543413895058;-0.3165954898998737943 -1.3193051144515628437 -0.12669207580152522241 2.1160033614098812116 1.6772641042967606495 -1.330582214426217158 -3.9533170731323803437 -0.28552935305838961222 -1.8105291519410458001 -0.11482626203732824999;0.58826466032166779829 -0.024656636546661170328 -0.70506099863931870342 -1.6642854607641814901 -0.98316463739922410614 0.93931790611645959999 -0.23256808379404181331 0.66589905698458595751 0.72682495686672321522 0.9934421170893804609;0.20933592488491536976 0.1383156555405147814 -1.9505348872056507137 -0.23531389621260173639 -0.81385737617528874921 -0.29396741121440173039 0.089299935105820599235 1.2570202923261217798 -0.080880994538541237104 -1.2892248606480662954;-0.25899108765402872878 0.17884492709490051876 1.6144234518879008178 -0.16176264992762320882 -1.0368961252938180273 -1.2069218648767634505 -1.5055252377592764912 0.66285357473846628906 0.35009180326248368065 0.75354771480198845524;-0.95520140090365757146 -0.62372863863210126212 0.52185691561402436367 0.66083005073382461436 0.23661441879040973069 -1.7975375048089197172 0.11822879231992070026 -1.6169593052959860824 0.5059255975296340635 0.34065476785678477922;-0.78422325311695861849 -0.058778180383044706381 0.91097128197140020411 0.12118211783985714802 0.5005961612130688243 -0.34983037276748479849 -0.30163945057328428456 0.18291826240480241195 -0.55935722226182693628 0.057711923122175330658;0.39593443499362163118 -0.63302415506024745095 0.059352962881558918307 0.98072335387676179419 -0.32418449353792633261 0.36007058060608593264 0.75248665821321958358 -0.85483155743812100358 0.74654075235405914501 -0.70328157184080386521];

% Layer 3
b3 = [1.3768504096114064783;-1.6906970824925715569;-1.1003014441427145798;0.67953699026168679076;0.076786812135834894844;-0.066718602500614426765;-0.4238091480795817545;-1.141862669377241124;-0.88998011250131159322;2.0562525691757320701];
LW3_2 = [-0.55585598388019963334 0.004110490999961153441 -1.0502731552245601065 -0.42456540906815487535 -1.0237109806025277425 -0.45396170951890607581 -0.46281034405656285013 0.41548876597228295848 -1.9467573073335298073 -0.75423474561345915657;0.29584089066359647857 0.033002385981189735764 1.0702432054267452255 -1.1181984788557197685 0.92754531624925073974 0.24825150002154205975 -0.16196629877321414015 0.12435074403624273021 -0.089913711843548266289 -0.015544902202442619291;0.73430769958146924203 -0.53785210962860174888 -0.89345261290473187987 0.56463638243435854136 -0.90441442189928844542 -0.61916927228429174956 -0.68097142420994982714 -0.41800821568038437626 -0.51843275173260205957 -0.57113594489906693852;-0.074684755358619417387 0.84959929307825599043 -0.47271851054401081704 1.8200157026428125384 -0.78796101064416257387 -1.9876591070157791918 0.28351646920716605527 -1.3271345036422501629 -0.6755088737942889221 0.056956172382724247483;0.29710956786848496947 0.40828157695577721453 0.78873040803842542346 1.2972084108744228459 -0.60723060502676817762 1.117143022595053381 0.77203864257476173538 0.87606844627456348373 -1.2659609881725613079 -0.13951224950707413752;-0.68609282082264344549 -0.13154801711972832767 0.24988316284735367923 0.5370989097888795305 -0.44627758928364813507 0.78706836501338495182 -1.0253042303190424978 -0.59236427774364541765 -0.72220089942152032592 0.29013167724818800242;-1.2927733305850561685 0.89945616759493196568 -0.1645865205910450324 0.45607385588989657332 -1.612651762189990734 -1.5212819525998391157 -0.29643412050543233027 0.52495503672484988833 -1.6715687601070219337 -0.53313107228974909724;-0.76717660569581225261 -1.0208506611628342942 1.5058563611765365398 0.45272007612806169918 0.21739320006079340675 -0.33639521383953352451 0.65539094324380531287 -0.41522381348399128864 -0.2451052398222072215 0.18141501764232817462;-0.75056190037603864873 0.49051465592550680395 0.031977870888336541733 -0.58524616805722029511 1.0230774559293018822 1.1283645831856270458 -1.1031626968279955037 0.84900833074074910645 -0.88053521915509169737 -0.30296860847216622314;2.6042852178903443949 0.061668978067529502118 0.53265489896874940179 -0.84179303300463226289 -1.6373004047401271688 -1.1954883014163966148 -5.1732778305898383664 -0.91799561218103786775 -0.36568543727663660459 -1.0595286239933419115];

% Layer 4
b4 = [1.7118559316378396673;-1.0401561434864898814;-1.2493357077621358719;-1.0289681874054945609;-0.29144327250101703664;0.085399847931284120217;-0.61062069341275249101;0.97115472642340616716;0.96331284449068210751;-2.2932482499831623457];
LW4_3 = [-0.55001283078642582147 -0.84026435527380771706 -0.63257009226815663627 -0.019604960837803341728 -0.59358446595008562685 -0.28712111168781601078 0.2075337783389595292 -0.019697843624966786258 -1.0475667313197651875 0.88253433435191419587;-0.060319790140138912493 -0.51080932009631441204 -0.80843381457637786269 -0.15475773434206899215 -0.10720224036933843903 -0.084654550464906982987 -0.49917909680153949026 -0.16563473139634726783 -0.73137982417421032455 -0.058757715757490752706;1.0924308346435822603 0.97645967467192695821 1.6651447720067444891 -2.0592905235592868785 -0.31019852260326385984 2.4468662955372515455 -0.093111559460529291776 0.21392108430472028813 4.7634038780480087993 1.0632303735583501503;1.105921357656660664 -1.196608644362370466 1.2819433518674243633 -0.67201831552422131022 0.44506409523486306634 -1.1863387067151520693 -2.064790264027726252 -0.13171889265149994142 0.14348124155524988321 -1.2952281904307532123;0.22531838929993946996 0.15517064367880420428 0.21104124903635987365 1.2786285548407718693 0.35106148134685416506 0.91056662765365270484 0.87812052112190464026 -0.47271409075099563024 1.0813835903377162495 2.500587070349642449;-0.0058062744312803995714 -0.97778096413975024159 -0.34147356217631030795 -0.58222255407822554041 -0.4648755309972417149 -0.49086288162966973392 -0.069353978126318410746 0.94839296592052924062 -0.83371662999574958075 -0.13022251360503200868;-0.5192169711162498702 -1.7792571987124063959 -0.28814159959105783981 0.29589028819346202548 0.56912711440822527642 0.58819622526937187512 -0.11938116379675925427 -0.077874218205795112113 -1.4214257522256805721 0.57718125114416440891;0.97053370491281654164 -1.777119640768366482 0.047462769262896033207 -0.83184286440629795489 0.75611072821105729247 0.17231558237400895761 0.17555033308384779267 0.57192303312021242068 -0.67418655008050754063 0.15200441787141302785;0.09480462708447252862 -0.33006517986407180043 -0.34889360194172008844 -1.1705320052391103847 0.033063702145023611545 0.67864322693889334026 0.65175060548636887248 -0.58653075715318070404 -0.28148829907789907345 0.71722496305376437498;0.026323979987305196754 0.44702723705054131509 -0.33815584682682292561 0.40570851485388548241 0.78062059187099630542 0.34729686149206279167 0.71250011913620658888 0.37136067805371009154 -0.74642618652398040613 0.9968610856439308332];

% Layer 5
b5 = [1.8746593363175227953;-0.9265842291859878177;0.91708374711058793238;-0.19760097497872189387;-0.13276723046808000528;-0.39450531071005973116;-0.56253369051258084177;-1.8102171221606571105;-1.7504507633334531747;2.1172560400970161787];
LW5_4 = [-0.01713992544754693384 -0.10571418000656548908 0.0037042803681108598356 -1.0400968337247613604 -0.62205442144576705843 -0.16419731219933247912 0.10323337463667855984 0.64018129497473463818 1.2786464855312626998 -0.22459458650641153654;0.30278936484816804109 0.18841414083817500935 0.67461240346146233993 -1.0340581792817646889 0.88802977571960217684 -0.66117404540769331156 1.0205825355511473074 0.4232761517214892466 0.90300153642031710799 -0.95518233664148410877;-0.10714228591189166317 -0.056059576753199134858 -0.35357486637902751925 1.1437795049333965292 -0.011783131689368958259 -0.0015971407712321739752 -0.12992220981191421325 -0.72654126888245684768 -0.79666925818594325204 -0.15540436424454134867;0.31863495050801171615 -0.41673848230995080844 2.5451359490478866476 -0.53823698952208753887 0.037621797025010103588 -0.759892843909441007 0.31851191302437675823 -0.23247877213558493237 -0.043213917681512552249 -0.71327790402150870186;0.25560545185890731767 0.05560889514620343671 0.23069915869894244698 0.28146168268798127388 0.45645670196422327702 -0.51521042196507926825 -0.58347435658680169013 0.053447941206825493043 1.6266178931127150964 -0.65642790400444417376;-0.14976904445702593494 0.087710496851901437187 -2.5250749046968468114 0.39903952858410635107 0.22273676581716661538 -0.56300437809149117552 -0.39065740875273757826 -0.084855942055330216278 -0.99897468310350645559 0.82772823137345397093;-0.7599839821509529747 0.14301352040050008263 -0.9575958418858752097 0.42884133079175290604 0.30143239370839286506 0.80425210920656786673 0.19907814053169811674 0.057612698839507030246 -0.41320850879804027489 0.74095234987709046592;-0.58246180447855822049 1.7343175364761105328 0.043024991393453074218 -0.71601753615399610364 -0.7920328432694372367 0.76065109137717179522 0.67387731752395618745 0.60678514478177014713 0.59223830769389806949 0.45803384576350275603;0.14346792752052228703 0.49516573241018435603 -1.4062664794273516122 -0.25955245253712633247 0.17571243903331457137 1.4137701899702903585 -0.22553680941163972706 0.45895914700865059199 -0.52037200176869780055 0.54285628456097656525;0.36580705922282497067 -0.57234578196316754362 0.30442613837138621236 0.23644568509559404923 -0.46579922301048237721 -1.944174759982005174 -0.15356108763265494122 -0.28964841679374248029 -0.55584400352473328777 -0.27443720789279824057];

% Layer 6
b6 = 0.59007003195757790071;
LW6_5 = [0.42903946761578831692 0.054947357448912832745 0.0021213839757411208364 0.40403335272753043705 -0.24142984363153624505 0.43986398100554990886 -0.46699208072898013011 -0.25910808626744724625 -0.86395717953058115413 -0.3849511884096494807];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = tansig_apply(repmat(b4,1,Q) + LW4_3*a3);
    
    % Layer 5
    a5 = tansig_apply(repmat(b5,1,Q) + LW5_4*a4);
    
    % Layer 6
    a6 = repmat(b6,1,Q) + LW6_5*a5;
    
    % Output 1
    Y{1,ts} = a6;
end

% Final Delay States
Xf = cell(1,0);
Af = cell(6,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end
