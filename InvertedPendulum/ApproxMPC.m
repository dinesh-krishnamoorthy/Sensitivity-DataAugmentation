function [Y,Xf,Af] = ApproxMPC(X,~,~)
%APPROXMPC neural network simulation function.
%
% Auto-generated by MATLAB, 15-Sep-2021 20:11:24.
% 
% [Y] = ApproxMPC(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 2xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [0;-5];
x1_step1.gain = [0.318309886183791;0.2];
x1_step1.ymin = -1;

% Layer 1
b1 = [-4.446745278946243829;3.4354568106539442596;2.6093248526352783578;0.46299638446457536123;-0.45485466554712133957;0.8112325949759109367;-1.3453723753278352682;2.7099625915641638585;-2.95576741930480269;4.3235794344384821386];
IW1_1 = [3.212981809769028807 2.9748328409774038583;-3.340998143054415781 -2.8846632628811406107;-1.4009272364401570421 -4.0697537387412561216;-3.7344221961311374614 -1.2333529045877178465;1.7406488869712455347 -3.9660788930999006929;-0.048263645679550382095 -4.3216202011173203701;-1.4477020109442673146 -3.9897344341217548802;0.17387143680010341829 4.2227800216119684151;-4.1655306959712499193 1.7539121633420373669;0.83012443907611854765 -4.3908946207832570963];

% Layer 2
b2 = [-1.787295535179242334;-1.3330447890435508373;-0.92744295133319309965;0.44376412468971054848;0.047793284100378356782;-0.068977498803113559966;-0.67247458415717742408;-1.0075216647977938145;-1.3896816406405334554;1.8491311356188711024];
LW2_1 = [0.35222405102479059646 -0.51314355510779341429 0.082754465203149718544 -0.63337550605552139782 0.46266948829241272279 -0.77187978534509471551 -0.72976877081763857902 -0.69569129513393646036 -0.59527690654148901483 -0.21662229072239133632;0.9666252711896657912 -0.44232888363363853657 -0.20018193592932523317 0.40898126991790995088 0.78560472897734545672 0.72207075917289731404 0.31352097873240575288 0.090656092574697005881 -0.35187207309737744687 0.82379408494272632346;0.24274866633265534954 -0.48523255501326140182 -0.38374633921220224764 0.1199988148211900002 0.31151829810285081024 -0.73833383053200052348 0.40115165315004475133 -0.62026968545907590347 -0.85472020622799782519 0.90975946711031729919;-0.70420675283486333651 0.077288082284602474537 0.930111514881762802 0.58610200359094555278 0.092358030758938114424 0.3368789449616019227 0.55569778379766621157 -0.60619909664854698672 0.31074968697070565193 -0.36076461973430334895;-0.73600213093504351924 0.38479229034503781293 -0.26100547464092410666 0.34461007626254980263 -0.75657903778616231172 1.0066929995416109556 0.66479565962990783135 -0.11132852497548607895 -0.16299653936190586223 0.17333062576453311943;-0.35751845627291323204 0.88657715230339806389 0.20791660621191032643 -0.75385793290197389283 -0.17143978459265654668 -0.22796337846228481583 -0.67047351095157514678 0.26240797962854967018 0.43736406929196008919 1.0401114072218915485;-0.51712833323283879938 -0.53447714143476510174 -0.53717586323400401405 -0.1001877533871489423 -0.86758607399504616975 0.38179022858095773563 0.73167603436898442926 -0.60579083560839552813 0.35713664917214094086 0.3678926095578022859;-0.33790278888067004637 -0.26234356330577979222 0.76302819829746126867 0.16215940706407622196 0.82199827300578331979 -0.47196049116820293357 -0.36478274570991275905 -0.49797906638386829625 -0.69517835033101416098 -0.680220120710794518;-0.38396341219869173367 -0.75429766875939974202 -0.90116612253562378143 0.27386624367976963867 -0.70137255343877635827 0.77714958907136677535 -0.11101500379727917422 0.42547529665225636286 -0.10343423908377571974 -0.64824677655223805761;0.89261721470679888935 -0.88271674716144032935 -0.10995337144186016765 -0.93094017084912628057 -0.14073541140285461548 0.2248563151019475348 -0.41715183285164808558 0.086357936697666129455 0.069405374856950446949 -0.15193863498337589757];

% Layer 3
b3 = [-1.8120493106035160391;1.3604427176156932422;0.91727159572909011676;0.49296229242970351914;-0.089797455279229013159;0.19887237856663972368;-0.59823583219023312996;1.0072214951496514246;-1.3762867798647069328;1.8234563093891447139];
LW3_2 = [0.97865803978780741001 0.22389425209757363167 -0.37639633384080417589 -1.0216048687461254385 -0.58425589459021531891 0.16784583401097633026 0.17636004124782206359 -0.17608629391232122341 -0.55906674731368466436 -0.18373172820229055624;-0.12700880432916919482 -0.09018165326089203071 -0.93338381585125607121 0.56420000732706343527 0.56971804824011673674 -0.39561695392579110386 0.55824715183998063761 -0.13686425687415387786 -0.93480851600430658888 0.41869438576066236868;-0.33603954033851834993 -0.31058063686030229489 -0.057066372618618910195 0.56546075083873303946 0.73433198859645987255 -0.60059130062752064116 0.52754465914853576614 -0.73298188841896849688 0.84207831073991545878 0.62626661422521312517;-0.11568531806427266584 0.69991330205880974979 0.5468257670877461063 0.791973415086436483 0.79087836400057720532 0.26427415049756824983 0.15364001869342158724 -0.41158104141890639038 0.5450644360629536278 -0.83868815126671247828;0.26361464349044616551 0.26592478965437510441 0.3941306983772567829 1.1007986931251647622 -0.43193833089259542346 -0.028009107703050553639 -0.54743739222757314966 -0.49984497036144143189 -0.24143286574638356257 -0.77919516695258583816;0.39274089981792581483 0.50128040703426568481 0.29308588795335288602 0.18282655031279831936 -0.5024126639067391098 -0.61682881086071661425 -0.38794366955821707466 0.20830130458027129592 -0.83735806272549695439 0.79045031776916907518;-0.7201476678990637037 -0.31668166033476397025 -0.5104401194240620887 0.025676069545909251113 -0.80825295327229507159 -0.92848864090578109298 0.55585974426228146328 0.37786939027167842919 0.13097796359481689299 0.44555235860496555933;0.71340666801917396178 0.79500808736463068893 -0.93207616444307961334 0.053884011449390749326 0.61406727712349162829 0.50101669320766140103 -0.023856007685404214541 -0.54054288534610928085 0.56971054923271369219 -0.13658707395211266977;-0.27625515504969766489 0.93416519826074218003 0.576987103435631421 -0.69646856593038064531 0.04160221669630920216 -0.82015482620754243115 -0.78089410987491358895 -0.8005978030643761123 -0.19488295258548665734 -0.33795353367665731392;0.87203944657082244074 0.02327742589840426507 0.57346677994909178722 0.76386068066012868805 -0.087863586547812955185 0.6286159717225334731 0.082527350692182935288 -0.82135731497046426952 -0.02813291981914611134 -0.30819976145154898139];

% Layer 4
b4 = [-1.7807865387893360154;-1.4007679720891337283;-0.89535830597442533918;0.52123728315880601958;-0.2457992681488939124;-0.10173999970084181277;0.59408708564175205513;-0.99534806331546732405;1.3539522373636143637;-1.7216478075132413128];
LW4_3 = [0.39776712376163370077 0.61497364752671779264 -0.15900253121289426028 0.033659609628543009363 0.66782864270328667899 0.57416438568108274509 0.59814977814444825199 -0.80807650358509197641 -0.66126047151038824801 -0.55361159270230053675;0.10352094034299502701 0.59418990271943916692 0.71414372022820604702 0.15776576831272642876 -0.67693140117851724469 -0.10384979503080189744 -0.26056000991433991842 0.53663510807023440119 -0.95497091340009321314 0.62283427872110475043;0.035771504682642910056 0.43524233984672611175 0.46579870697523378942 0.59745406058465311272 0.73806614328626440891 -0.93634797181431339563 0.20714042847647498591 -0.65348194912033896742 0.97769024398413917343 0.064973681411797684637;-0.48882146545770843726 0.73409312876209986687 -0.68298926193222087022 0.6509124153666678847 0.82733195206666132471 -0.090796468735409141537 -0.64177641357857362348 -0.56696452456524004671 0.01565708961763515733 0.022099998930350348014;0.34017005372505304539 0.55742226290110052922 0.39089121950629740487 -0.48523375207507807305 -0.59551844385454244524 0.16437222468422180155 0.48729790402328587717 -0.95781015232517652258 0.53778456235482807735 0.77976142045411156456;-0.49523085947095835113 0.03911985775619421235 -0.65937135513825695377 -0.23855665929435376782 0.77261837190388626961 0.59940229002613398812 -0.26188702885856091074 0.57053598829283824756 0.80888929248987340159 -0.66801256038948086946;0.68090138804365951675 0.67547896857882971933 0.57880184569067849587 0.48991353455391478677 -0.23934279419524889798 0.6686148845634366511 -0.46956851757832590577 0.70522430656520607162 -0.59924822041348058121 0.22693659224549994624;-0.64446368097184814072 -0.31521699553397786175 -0.84703058654677831907 -0.036281515973268341213 0.34678450931509524624 0.31821191912889051912 -0.58219550044208367989 -0.69369731236676346331 -0.60999652310774477026 -0.67239566237540138172;0.52852091612270868382 0.25111717299974806172 -0.34751104320978903894 -0.90254479248944829983 -0.80731777747596455974 0.085697783745099537223 0.060233383043698685011 0.37062245205257793312 0.71479648178138421866 0.75496086642750503959;-0.15009273137566542244 0.89595600598185765051 0.72210904684835564016 -0.19313887881252289613 -0.27697942601825564779 0.0062980067744489321574 -0.72149840811351373393 0.67478929106961127449 -0.42971418792618149007 0.83482488442927726968];

% Layer 5
b5 = [-1.8455120902196155974;1.3720475537664313936;-0.9957474318880994435;0.59275763862405494997;-0.19747806728261377285;-0.18457239893126947683;-0.5794517359402207024;-0.98435008303700033405;1.3729047337510191795;-1.7717692997575684721];
LW5_4 = [0.20371214641313295513 0.60234702405254569868 -0.90207872216453433012 0.31697416374623721413 0.27997164711804395365 0.057045629620006296778 -0.72379813414866367438 -0.24352134720246684796 0.55910848351817465929 -0.84252243589718411876;-0.37958239603647381255 0.38482862269708201231 -0.76064204998537521263 -0.07079400004190282425 -0.041291416172430824016 0.81777922389834212247 -0.3596843066357600649 -0.90265411717321164531 0.69306230732421125751 0.34882446148015155973;0.82789511960067285745 0.36437524881115801456 -0.34862370489573946131 -0.69284851631953026097 1.0615621849622147721 0.39231031988549575074 0.0963379338730901702 -0.13841278719841546008 -0.051416133410742956289 0.68232761167796673885;-0.21811437796192340022 -0.50476582268095315786 1.3847496033852331188 -0.81321769167113411303 -0.5370655286033428899 0.48562634557133077529 -0.32172220226686809585 -0.20676173557413729531 -0.10864689657893537855 -0.34221023388730142933;0.62882712476430013826 0.12528561074610713999 0.6353069181945913968 -0.62590755576482703937 -0.50873771057307415333 0.28621997947851285371 -1.0004230144380645839 -0.61121407405958982917 0.00087220699723825696921 0.42497596283407329532;-0.51455678397644388777 0.076868436863360756206 0.34990576484955560055 0.18905321060034357972 -0.5847217629118257598 0.78010296257000244502 0.013398722242963855694 -0.8142656415978967166 0.5109564644500675934 0.91192038902301086889;-0.51767587689040406307 -0.24258575597273970836 -0.1679373935203584689 -0.35194386861564364022 0.75023312972398936704 1.0195233938174377286 -0.10457996792987057921 0.4473381020456165813 -0.34975472212121255788 0.85056994894859816458;-0.74246818419269511313 0.42913692385123797246 0.77586822544416811365 -0.80809981894368720923 -0.63826335784629328884 0.28509465770633696247 -0.33109938066072208684 -0.4806933352204820209 0.525748939692022077 0.024456004154934537359;0.075274981396310419735 0.40326145364705717755 0.78546388140922607235 0.232252719712561978 0.70673005494674057125 -0.78878375325150829056 0.80505958093740470627 -0.45447667715894840557 0.4509962711790043155 0.30041731767521079322;-0.012183133439246519869 0.20223034496421574135 -0.16294514974475116098 0.12631096081939122144 0.85139626982961036372 -1.0690256184313655652 0.078981529067867733973 0.1715100798136072191 -1.0867111310827093362 -0.28771126482195169549];

% Layer 6
b6 = 0.2379650822290159673;
LW6_5 = [-0.79703712425414108278 -0.49471082985148684408 -0.86864332346616457414 1.1227793963609078443 -0.098378315992020723413 0.55808753679068812126 0.47531960645457138614 -0.029711862756435211685 -0.051113421188295204978 0.58228195584532937978];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0194062520675682;
y1_step1.xoffset = -51.5297851701723;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = tansig_apply(repmat(b4,1,Q) + LW4_3*a3);
    
    % Layer 5
    a5 = tansig_apply(repmat(b5,1,Q) + LW5_4*a4);
    
    % Layer 6
    a6 = repmat(b6,1,Q) + LW6_5*a5;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a6,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(6,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
